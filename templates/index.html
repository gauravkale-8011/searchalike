<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VisuaMatch - AI Image Similarity Search</title>
    <link rel="icon" type="image/png" sizes="32x32"
      href="{{ url_for('static', filename='icons/icon.png') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>
<body>

<header>
    <div class="container">
        <div class="header-content">
            <div class="logo">
                <div class="logo-icon">üîç</div>
                <span class="logo-text">VisuaMatch</span>
            </div>
            <div class="stats">
                <div class="stat-item">
                    <span class="stat-label">Dataset:</span>
                    <span class="stat-value" id="stat-images">0</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">Model:</span>
                    <span class="stat-value" id="stat-model">Loading...</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">Status:</span>
                    <span class="stat-value">üü¢ Ready</span>
                </div>
            </div>
        </div>
    </div>
</header>

<main>
<div class="container">
<section class="upload-section">

<h1 class="upload-title">Find Similar Images</h1>
<p class="upload-subtitle">Upload an image to search visually similar results</p>

<form
        id="searchForm"
        class="upload-form"
        method="POST"
        action="/search"
        enctype="multipart/form-data"
>

<div class="form-row">

<!-- IMAGE UPLOAD -->
<div class="form-group">
<label class="form-label">Select Image <span>*</span></label>

<div class="dropzone" id="dropzone">
    <div class="dropzone-content">
        <div class="dropzone-icon">üì∏</div>
        <div class="dropzone-text">
            <span class="dropzone-highlight">Click to upload</span> or drag & drop
        </div>
        <small>PNG, JPG, JPEG, WEBP (max 16MB)</small>
    </div>
    <input type="file" id="fileInput" name="file" class="file-input" accept="image/*" required>
</div>

<div id="preview-container" style="display:none;margin-top:20px">
    <div class="preview-title">Preview</div>
    <img id="preview-image" class="preview-image">
</div>
</div>

<!-- SLIDER -->
<div class="form-group">
<label class="form-label">Results Count <span>*</span></label>

<div class="slider-container">
<label>Retrieve <span id="rangeValue">10</span> Matches</label>
<input
    type="range"
    id="topK"
    name="top_k"
    min="1"
    max="50"
    value="10"
    oninput="updateRange(this.value)"
>
</div>
</div>

</div>

<div class="btn-container">
<button type="reset" class="btn btn-secondary" id="resetBtn">Clear</button>
<button type="submit" class="btn btn-primary" id="submitBtn">Search Now</button>
</div>

</form>
</section>
</div>
</main>

<script src="{{ url_for('static', filename='js/script.js') }}"></script>

<script>
document.addEventListener("DOMContentLoaded", () => {
    fetch("/stats")
        .then(res => res.json())
        .then(data => {
            if (data.num_images) {
                document.getElementById("stat-images").innerText = data.num_images;
            }
            if (data.model_info) {
                document.getElementById("stat-model").innerText = data.model_info.model_type;
            }
        });
});
</script>

</body>
</html>
